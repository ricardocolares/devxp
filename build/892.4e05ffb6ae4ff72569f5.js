"use strict";(self.webpackChunkpayload_blog_typescript=self.webpackChunkpayload_blog_typescript||[]).push([[892],{46892:(e,l,a)=>{a.r(l),a.d(l,{default:()=>D});var t=a(67294),n=a(38439),i=a(28630),d=a(90546),o=a.n(d),r=a(77329),s=a(87578),c=a(64012),u=a(19826),p=a(48170),m=a(40684),v=a(90666),f=a(35193),E=a(54945),h=a(77070),y=a(45074),w=a(9684),b=a(22158),_=a(5590),g=a(83780),$=a(91455),R=a(49185),x=a(95738),C=a(74020);a(35396);const k="array-field",D=o()((e=>{var l,a;const{name:d,path:o,fields:D,fieldTypes:T,validate:A=f.array,required:I,maxRows:S,minRows:O,permissions:N,admin:{readOnly:P,description:Z,condition:L,className:F}}=e,M=o||d,V=(null==(W=e)?void 0:W.labels)?W.labels:(null==W?void 0:W.label)?{singular:W.label,plural:void 0}:{singular:"Row",plural:"Rows"};var W;const q=null!==(l=null==e?void 0:e.label)&&void 0!==l?l:null===(a=null==e?void 0:e.labels)||void 0===a?void 0:a.singular,{preferencesKey:B}=(0,y.x5)(),{getPreference:G}=(0,$.G)(),{setPreference:H}=(0,$.G)(),[K,U]=(0,t.useReducer)(s.Z,void 0),j=(0,c.useForm)(),{user:z}=(0,i.a)(),{id:J}=(0,y.x5)(),Q=(0,m.bU)(),X=(0,w.T)(),{dispatchFields:Y}=j,ee=(0,t.useCallback)(((e,l)=>A(e,{...l,minRows:O,maxRows:S,required:I})),[S,O,I,A]),[le,ae]=(0,t.useState)(!1),{showError:te,errorMessage:ne,value:ie,setValue:de}=(0,p.Z)({path:M,validate:ee,disableFormData:le,condition:L}),oe=(0,t.useCallback)((async e=>{const l=await(0,u.Z)({fieldSchema:D,operation:X,id:J,user:z,locale:Q});Y({type:"ADD_ROW",rowIndex:e,subFieldState:l,path:M}),U({type:"ADD",rowIndex:e}),de(ie+1),setTimeout((()=>{(0,x.w)(`${M}-row-${e+1}`)}),0)}),[U,Y,D,M,de,ie,X,J,z,Q]),re=(0,t.useCallback)((async e=>{Y({type:"DUPLICATE_ROW",rowIndex:e,path:M}),U({type:"ADD",rowIndex:e}),de(ie+1),setTimeout((()=>{(0,x.w)(`${M}-row-${e+1}`)}),0)}),[U,Y,M,de,ie]),se=(0,t.useCallback)((e=>{U({type:"REMOVE",rowIndex:e}),Y({type:"REMOVE_ROW",rowIndex:e,path:M}),de(ie-1)}),[U,Y,M,ie,de]),ce=(0,t.useCallback)(((e,l)=>{U({type:"MOVE",moveFromIndex:e,moveToIndex:l}),Y({type:"MOVE_ROW",moveFromIndex:e,moveToIndex:l,path:M})}),[U,Y,M]),ue=(0,t.useCallback)((e=>{if(!e.destination)return;const l=e.source.index,a=e.destination.index;ce(l,a)}),[ce]),pe=(0,t.useCallback)((async(e,l)=>{var a,t,n;if(U({type:"SET_COLLAPSE",id:e,collapsed:l}),B){const i=await G(B)||{fields:{}};let d=(null===(t=null===(a=null==i?void 0:i.fields)||void 0===a?void 0:a[M])||void 0===t?void 0:t.collapsed.filter((e=>K.find((l=>l.id===e)))))||[];l?d.push(e):d=d.filter((l=>l!==e)),H(B,{...i,fields:{...(null==i?void 0:i.fields)||{},[M]:{...null===(n=null==i?void 0:i.fields)||void 0===n?void 0:n[M],collapsed:d}}})}}),[B,M,H,K,G]),me=(0,t.useCallback)((async e=>{var l;if(U({type:"SET_ALL_COLLAPSED",collapse:e}),B){const a=await G(B)||{fields:{}};H(B,{...a,fields:{...(null==a?void 0:a.fields)||{},[M]:{...null===(l=null==a?void 0:a.fields)||void 0===l?void 0:l[M],collapsed:e?K.map((({id:e})=>e)):[]}}})}}),[M,G,B,K,H]);(0,t.useEffect)((()=>{(async()=>{var e,l;const a=j.getDataByPath(M),t=await G(B)||{fields:{}};U({type:"SET_ALL",data:a||[],collapsedState:null===(l=null===(e=null==t?void 0:t.fields)||void 0===e?void 0:e[M])||void 0===l?void 0:l.collapsed})})()}),[j,M,G,B]),(0,t.useEffect)((()=>{de((null==K?void 0:K.length)||0,!0),0===(null==K?void 0:K.length)?ae(!1):ae(!0)}),[K,de]);const ve=S&&(null==K?void 0:K.length)>=S,fe=["field-type",k,F].filter(Boolean).join(" ");return K?t.createElement(n.Z5,{onDragEnd:ue},t.createElement("div",{id:`field-${M.replace(/\./gi,"__")}`,className:fe},t.createElement("div",{className:`${k}__error-wrap`},t.createElement(v.Z,{showError:te,message:ne})),t.createElement("header",{className:`${k}__header`},t.createElement("div",{className:`${k}__header-wrap`},t.createElement("h3",null,q),t.createElement("ul",{className:`${k}__header-actions`},t.createElement("li",null,t.createElement("button",{type:"button",onClick:()=>me(!0),className:`${k}__header-action`},"Collapse All")),t.createElement("li",null,t.createElement("button",{type:"button",onClick:()=>me(!1),className:`${k}__header-action`},"Show All")))),t.createElement(h.Z,{value:ie,description:Z})),t.createElement(n.bK,{droppableId:"array-drop"},(e=>t.createElement("div",{ref:e.innerRef,...e.droppableProps},K.length>0&&K.map(((e,l)=>{const a=l+1;return t.createElement(n._l,{key:e.id,draggableId:e.id,index:l,isDragDisabled:P},(n=>t.createElement("div",{id:`${M}-row-${l}`,ref:n.innerRef,...n.draggableProps},t.createElement(b.z,{collapsed:e.collapsed,onToggle:l=>pe(e.id,l),className:`${k}__row`,key:e.id,dragHandleProps:n.dragHandleProps,header:`${V.singular} ${a>=10?a:`0${a}`}`,actions:P?void 0:t.createElement(R.A,{rowCount:K.length,duplicateRow:re,addRow:oe,moveRow:ce,removeRow:se,index:l})},t.createElement(C.Z,{name:`${M}.${l}.id`,value:e.id}),t.createElement(_.Z,{className:`${k}__fields`,forceRender:!0,readOnly:P,fieldTypes:T,permissions:null==N?void 0:N.fields,fieldSchema:D.map((e=>({...e,path:`${M}.${l}${(0,g.fieldAffectsData)(e)?`.${e.name}`:""}`})))})))))})),(K.length<O||I&&0===K.length)&&t.createElement(E.Z,{type:"error"},"This field requires at least"," ",O?`${O} ${V.plural}`:`1 ${V.singular}`),0===K.length&&P&&t.createElement(E.Z,null,"This field has no"," ",V.plural,"."),e.placeholder))),!P&&!ve&&t.createElement("div",{className:`${k}__add-button-wrap`},t.createElement(r.Z,{onClick:()=>oe(ie),buttonStyle:"icon-label",icon:"plus",iconStyle:"with-border",iconPosition:"left"},`Add ${V.singular}`)))):null}))}}]);