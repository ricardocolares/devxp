"use strict";(self.webpackChunkpayload_blog_typescript=self.webpackChunkpayload_blog_typescript||[]).push([[995],{38398:(e,t,l)=>{l.d(t,{Z:()=>s});var a=l(67294),n=l(3902),i=l(39006);const s=e=>{const{useAsTitle:t,title:l,data:s,fallback:o="[untitled]"}=e,r=(0,n.Z)(t);let c=s&&s[t];c||(c=r),c||(c=null==s?void 0:s.id),c||(c=o),c=l||c;return c===(null==s?void 0:s.id)?a.createElement(i.Z,{id:null==s?void 0:s.id}):a.createElement("span",{className:"render-title"},c)}},73588:(e,t,l)=>{l.d(t,{Z:()=>k});var a=l(67294),n=l(39249),i=l(9980),s=l(28571),o=l(76067),r=l(75212),c=l(77329),d=l(74007),u=l(64012),m=l(44586),v=l(48170),p=l(953),f=l(55532),E=l(35193),y=l(71851),g=l(39599);l(25891);const b="generate-confirmation",h=e=>{const{setKey:t,highlightField:l}=e,{toggle:i}=(0,y.useModal)(),s="generate-confirmation";return a.createElement(a.Fragment,null,a.createElement(c.Z,{size:"small",buttonStyle:"secondary",onClick:()=>{i(s)}},"Generate new API key"),a.createElement(y.Modal,{slug:s,className:b},a.createElement(g.Z,{className:`${b}__template`},a.createElement("h1",null,"Confirm Generation"),a.createElement("p",null,"Generating a new API key will"," ",a.createElement("strong",null,"invalidate")," ","the previous key."," ","Are you sure you wish to continue?"),a.createElement(c.Z,{buttonStyle:"secondary",type:"button",onClick:()=>{i(s)}},"Cancel"),a.createElement(c.Z,{onClick:()=>{t(),i(s),n.Am.success("New API Key Generated.",{autoClose:3e3}),l(!0)}},"Generate"))))},$="apiKey",Z=e=>(0,E.text)(e,{minLength:24,maxLength:48,data:{},siblingData:{}}),_=()=>{const[e,t]=(0,a.useState)(null),[l,n]=(0,a.useState)(!1),{getField:i}=(0,u.useWatchForm)(),s=i($),o=null==s?void 0:s.value,r=(0,a.useMemo)((()=>a.createElement("div",{className:"api-key__label"},a.createElement("span",null,"API Key"),a.createElement(f.Z,{value:o}))),[o]),c=(0,v.Z)({path:"apiKey",validate:Z}),{value:d,setValue:E}=c;(0,a.useEffect)((()=>{t((0,m.Z)())}),[]),(0,a.useEffect)((()=>{o||E(e)}),[o,E,e]),(0,a.useEffect)((()=>{l&&setTimeout((()=>{n(!1)}),1e4)}),[l]);const y=["field-type","api-key","read-only"].filter(Boolean).join(" ");return a.createElement(a.Fragment,null,a.createElement("div",{className:y},a.createElement(p.Z,{htmlFor:$,label:r}),a.createElement("input",{value:d||"",className:l?"highlight":void 0,disabled:!0,type:"text",id:"apiKey",name:"apiKey"})),a.createElement(h,{setKey:()=>E((0,m.Z)()),highlightField:()=>{l&&n(!1),setTimeout((()=>{n(!0)}),1)}}))};l(32554);const C="auth-fields",k=e=>{const{useAPIKey:t,requirePassword:l,verify:m,collection:{slug:v},collection:p,email:f,operation:E}=e,[y,g]=(0,a.useState)(l),{getField:b}=(0,u.useWatchForm)(),h=(0,u.useFormModified)(),$=b("enableAPIKey");(0,a.useEffect)((()=>{h||g(!1)}),[h]);const{serverURL:Z,routes:{api:k}}=(0,i.Z)(),w=(0,a.useCallback)((async()=>{const e=`${Z}${k}/${v}/unlock`;200===(await fetch(e,{headers:{"Content-Type":"application/json"},body:JSON.stringify({email:f}),method:"post"})).status?n.Am.success("Successfully unlocked",{autoClose:3e3}):n.Am.error("Successfully unlocked")}),[Z,k,v,f]);return p.auth.disableLocalStrategy?null:a.createElement("div",{className:C},a.createElement(s.Z,{required:!0,name:"email",label:"Email",admin:{autoComplete:"email"}}),(y||l)&&a.createElement("div",{className:"auth-fields__changing-password"},a.createElement(o.Z,{autoComplete:"off",required:!0,name:"password",label:"New Password"}),a.createElement(d.Z,null),!l&&a.createElement(c.Z,{size:"small",buttonStyle:"secondary",onClick:()=>g(!1)},"Cancel")),!y&&!l&&a.createElement(c.Z,{size:"small",buttonStyle:"secondary",onClick:()=>g(!0)},"Change Password"),"update"===E&&a.createElement(c.Z,{size:"small",buttonStyle:"secondary",onClick:()=>w()},"Force Unlock"),t&&a.createElement("div",{className:"auth-fields__api-key"},a.createElement(r.Z,{label:"Enable API Key",name:"enableAPIKey"}),(null==$?void 0:$.value)&&a.createElement(_,null)),m&&a.createElement(r.Z,{label:"Verified",name:"_verified"}))}},5995:(e,t,l)=>{l.r(t),l.d(t,{default:()=>J});var a=l(67294),n=l(5977),i=l(9980),s=l(28630),o=l(75091),r=l(47489),c=l(2143),d=l(73727),u=l(49546),m=l(28584),v=l(93313),p=l(40829),f=l(4983),E=l(46268),y=l(5590),g=l(55532),b=l(77329),h=l(64012);l(79280);const $=({slug:e})=>{const{push:t}=(0,n.k6)(),{getData:l}=(0,h.useForm)(),{routes:{admin:s}}=(0,i.Z)(),o=(0,a.useCallback)((()=>{const a=l();t({pathname:`${s}/collections/${e}/create`,state:{data:a}})}),[t,l,e,s]);return a.createElement(b.Z,{id:"action-duplicate",buttonStyle:"none",className:"duplicate",onClick:o},"Duplicate")};var Z=l(39249),_=l(71851),C=l(39599),k=l(3902),w=l(93780);l(78612);const A="delete-document",N=e=>{const{title:t,id:l,buttonId:s,collection:{admin:{useAsTitle:o},slug:r,labels:{singular:c}={}}={}}=e,{serverURL:d,routes:{api:u,admin:m}}=(0,i.Z)(),{setModified:v}=(0,h.useForm)(),[p,f]=(0,a.useState)(!1),{closeAll:E,toggle:y}=(0,_.useModal)(),g=(0,n.k6)(),$=(0,k.Z)(o)||l,N=t||$,S=`delete-${l}`,P=(0,a.useCallback)((()=>{Z.Am.error(`There was an error while deleting ${$}. Please check your connection and try again.`)}),[$]),F=(0,a.useCallback)((()=>{f(!0),v(!1),w.E.delete(`${d}${u}/${r}/${l}`,{headers:{"Content-Type":"application/json"}}).then((async e=>{try{const t=await e.json();return e.status<400?(E(),Z.Am.success(`${c} "${$}" successfully deleted.`),g.push(`${m}/collections/${r}`)):(E(),t.errors?t.errors.forEach((e=>Z.Am.error(e.message))):P(),!1)}catch(e){return P()}}))}),[P,E,g,l,c,r,$,m,u,d,v]);return l?a.createElement(a.Fragment,null,a.createElement("button",{type:"button",id:s,className:"delete-document__toggle",onClick:e=>{e.preventDefault(),f(!1),y(S)}},"Delete"),a.createElement(_.Modal,{slug:S,className:A},a.createElement(C.Z,{className:"delete-document__template"},a.createElement("h1",null,"Confirm deletion"),a.createElement("p",null,"You are about to delete the"," ",c," ",'"',a.createElement("strong",null,N),'". Are you sure?'),a.createElement(b.Z,{id:"confirm-cancel",buttonStyle:"secondary",type:"button",onClick:p?void 0:()=>y(S)},"Cancel"),a.createElement(b.Z,{onClick:p?void 0:F,id:"confirm-delete"},p?"Deleting...":"Confirm")))):null};var S=l(37276),P=l(25896),F=l(38398),L=l(50854),U=l(73588),I=l(8742),K=l(56054),R=l(17095),T=l(24531),D=l(11750),M=l(8792),V=l(45074),j=l(9684),G=l(69850);l(37841);const x="collection-edit",q=e=>{var t,l,s,o,r,c,b,h,Z,_,C,k,w,A,q,z,B,O;const{params:{id:W}={}}=(0,n.$B)(),{admin:{dateFormat:H},routes:{admin:J}}=(0,i.Z)(),{publishedDoc:Y}=(0,V.x5)(),{collection:Q,isEditing:X,data:ee,onSave:te,permissions:le,isLoading:ae,initialState:ne,apiURL:ie,action:se,hasSavePermission:oe}=e,{slug:re,fields:ce,admin:{useAsTitle:de,disableDuplicate:ue,preview:me,hideAPIURL:ve},versions:pe,timestamps:fe,auth:Ee,upload:ye}=Q,ge=[x,X&&`${x}--is-editing`].filter(Boolean).join(" "),be=X?"update":"create";return a.createElement("div",{className:ge},ae&&a.createElement(p.Z,null),!ae&&a.createElement(j.R.Provider,{value:be},a.createElement(v.Z,{className:`${x}__form`,method:W?"put":"post",action:se,onSuccess:te,disabled:!oe,initialState:ne},a.createElement("div",{className:`${x}__main`},a.createElement(S.Z,{title:`${X?"Editing":"Creating"} - ${Q.labels.singular}`,description:`${X?"Editing":"Creating"} - ${Q.labels.singular}`,keywords:`${Q.labels.singular}, Payload, CMS`}),a.createElement(m.Z,null),!((null===(t=Q.versions)||void 0===t?void 0:t.drafts)&&(null===(s=null===(l=Q.versions)||void 0===l?void 0:l.drafts)||void 0===s?void 0:s.autosave))&&a.createElement(L.Z,null),a.createElement(G.T,{className:`${x}__edit`},a.createElement("header",{className:`${x}__header`},a.createElement("h1",null,a.createElement(F.Z,{data:ee,useAsTitle:de,fallback:"[Untitled]"}))),Ee&&a.createElement(U.Z,{useAPIKey:Ee.useAPIKey,requirePassword:!X,verify:Ee.verify,collection:Q,email:null==ee?void 0:ee.email,operation:be}),ye&&a.createElement(K.Z,{data:ee,collection:Q}),a.createElement(y.Z,{readOnly:!oe,permissions:le.fields,filter:e=>{var t,l;return!(null===(t=null==e?void 0:e.admin)||void 0===t?void 0:t.position)||"sidebar"!==(null===(l=null==e?void 0:e.admin)||void 0===l?void 0:l.position)},fieldTypes:P.Z,fieldSchema:ce}))),a.createElement("div",{className:`${x}__sidebar-wrap`},a.createElement("div",{className:`${x}__sidebar`},a.createElement("div",{className:`${x}__sidebar-sticky-wrap`},a.createElement("ul",{className:`${x}__collection-actions`},(null===(o=null==le?void 0:le.create)||void 0===o?void 0:o.permission)&&a.createElement(a.Fragment,null,a.createElement("li",null,a.createElement(d.Link,{id:"action-create",to:`${J}/collections/${re}/create`},"Create New")),!ue&&a.createElement("li",null,a.createElement($,{slug:re}))),(null===(r=null==le?void 0:le.delete)||void 0===r?void 0:r.permission)&&a.createElement("li",null,a.createElement(N,{collection:Q,id:W,buttonId:"action-delete"}))),a.createElement("div",{className:`${x}__document-actions${(null===(c=Q.versions)||void 0===c?void 0:c.drafts)&&!(null===(h=null===(b=Q.versions)||void 0===b?void 0:b.drafts)||void 0===h?void 0:h.autosave)||X&&me?` ${x}__document-actions--has-2`:""}`},me&&(!(null===(Z=Q.versions)||void 0===Z?void 0:Z.drafts)||(null===(C=null===(_=Q.versions)||void 0===_?void 0:_.drafts)||void 0===C?void 0:C.autosave))&&a.createElement(f.Z,{generatePreviewURL:me,data:ee}),oe&&a.createElement(a.Fragment,null,(null===(k=Q.versions)||void 0===k?void 0:k.drafts)&&a.createElement(a.Fragment,null,!Q.versions.drafts.autosave&&a.createElement(M.Z,null),a.createElement(D.Z,null)),!(null===(w=Q.versions)||void 0===w?void 0:w.drafts)&&a.createElement(E.Z,{buttonId:"action-save"},"Save"))),a.createElement("div",{className:`${x}__sidebar-fields`},X&&me&&(null===(A=Q.versions)||void 0===A?void 0:A.drafts)&&!(null===(z=null===(q=Q.versions)||void 0===q?void 0:q.drafts)||void 0===z?void 0:z.autosave)&&a.createElement(f.Z,{generatePreviewURL:me,data:ee}),(null===(B=Q.versions)||void 0===B?void 0:B.drafts)&&a.createElement(a.Fragment,null,a.createElement(T.Z,null),(null===(O=Q.versions)||void 0===O?void 0:O.drafts.autosave)&&oe&&a.createElement(R.Z,{publishedDocUpdatedAt:(null==Y?void 0:Y.updatedAt)||(null==ee?void 0:ee.createdAt),collection:Q,id:W})),a.createElement(y.Z,{readOnly:!oe,permissions:le.fields,filter:e=>{var t;return"sidebar"===(null===(t=null==e?void 0:e.admin)||void 0===t?void 0:t.position)},fieldTypes:P.Z,fieldSchema:ce})),X&&a.createElement("ul",{className:`${x}__meta`},!ve&&a.createElement("li",{className:`${x}__api-url`},a.createElement("span",{className:`${x}__label`},"API URL"," ",a.createElement(g.Z,{value:ie})),a.createElement("a",{href:ie,target:"_blank",rel:"noopener noreferrer"},ie)),pe&&a.createElement("li",null,a.createElement("div",{className:`${x}__label`},"Versions"),a.createElement(I.Z,{collection:Q,id:W})),fe&&a.createElement(a.Fragment,null,ee.updatedAt&&a.createElement("li",null,a.createElement("div",{className:`${x}__label`},"Last Modified"),a.createElement("div",null,(0,u.default)(new Date(ee.updatedAt),H))),((null==Y?void 0:Y.createdAt)||(null==ee?void 0:ee.createdAt))&&a.createElement("li",null,a.createElement("div",{className:`${x}__label`},"Created"),a.createElement("div",null,(0,u.default)(new Date((null==Y?void 0:Y.createdAt)||(null==ee?void 0:ee.createdAt)),H)))))))))))};var z=l(83780);const B=(e,t)=>t?e.fields.filter((e=>(0,z.fieldAffectsData)(e)&&"id"!==e.name||!0)):e.fields;var O=l(19826),W=l(40684),H=l(91455);const J=e=>{var t,l,d;const{collection:u,isEditing:m}=e,{slug:v,labels:{plural:p},admin:{useAsTitle:f,components:{views:{Edit:E}={}}={}}={}}=u,[y]=(0,a.useState)((()=>B(u,m))),[g]=(0,a.useState)((()=>({...u,fields:y}))),b=(0,W.bU)(),{serverURL:h,routes:{admin:$,api:Z}}=(0,i.Z)(),{params:{id:_}={}}=(0,n.$B)(),{state:C}=(0,n.TH)(),k=(0,n.k6)(),{setStepNav:w}=(0,o.FP)(),[A,N]=(0,a.useState)(),{permissions:S,user:P}=(0,s.a)(),{getVersions:F,preferencesKey:L}=(0,V.x5)(),{getPreference:U}=(0,H.G)(),I=(0,a.useCallback)((async e=>{var t;if(F(),m){const t=await(0,O.Z)({fieldSchema:g.fields,data:e.doc,user:P,id:_,operation:"update",locale:b});N(t)}else k.push(`${$}/collections/${g.slug}/${null===(t=null==e?void 0:e.doc)||void 0===t?void 0:t.id}`)}),[$,g,k,m,F,P,_,b]),[{data:K,isLoading:R,isError:T}]=(0,r.Z)(m?`${h}${Z}/${v}/${_}`:null,{initialParams:{"fallback-locale":"null",depth:0,draft:"true"}}),D=(null==C?void 0:C.data)||K;if((0,a.useEffect)((()=>{const e=[{url:`${$}/collections/${v}`,label:p}];if(m){let t="";D&&(t=f?D[f]?D[f]:"[Untitled]":D.id),e.push({label:t})}else e.push({label:"Create New"});w(e)}),[w,m,p,D,v,f,$]),(0,a.useEffect)((()=>{if(R)return;(async()=>{const e=await(0,O.Z)({fieldSchema:y,data:D,user:P,operation:m?"update":"create",id:_,locale:b});await U(L),N(e)})()}),[D,y,m,_,P,b,R,L,U]),T)return a.createElement(n.l_,{to:`${$}/not-found`});const M=null===(t=null==S?void 0:S.collections)||void 0===t?void 0:t[v],j=`${h}${Z}/${v}/${_}${g.versions.drafts?"?draft=true":""}`,G=`${h}${Z}/${v}${m?`/${_}`:""}?locale=${b}&depth=0&fallback-locale=null`,x=m&&(null===(l=null==M?void 0:M.update)||void 0===l?void 0:l.permission)||!m&&(null===(d=null==M?void 0:M.create)||void 0===d?void 0:d.permission);return a.createElement(c.Z,{DefaultComponent:q,CustomComponent:E,componentProps:{isLoading:!A,data:D,collection:g,permissions:M,isEditing:m,onSave:I,initialState:A,hasSavePermission:x,apiURL:j,action:G}})}},3902:(e,t,l)=>{l.d(t,{Z:()=>n});var a=l(64012);const n=e=>{const{getField:t}=(0,a.useWatchForm)(),l=t(e);return null==l?void 0:l.value}},44586:(e,t,l)=>{var a;l.d(t,{Z:()=>u});var n=new Uint8Array(16);function i(){if(!a&&!(a="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return a(n)}const s=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;const o=function(e){return"string"==typeof e&&s.test(e)};for(var r=[],c=0;c<256;++c)r.push((c+256).toString(16).substr(1));const d=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=(r[e[t+0]]+r[e[t+1]]+r[e[t+2]]+r[e[t+3]]+"-"+r[e[t+4]]+r[e[t+5]]+"-"+r[e[t+6]]+r[e[t+7]]+"-"+r[e[t+8]]+r[e[t+9]]+"-"+r[e[t+10]]+r[e[t+11]]+r[e[t+12]]+r[e[t+13]]+r[e[t+14]]+r[e[t+15]]).toLowerCase();if(!o(l))throw TypeError("Stringified UUID is invalid");return l};const u=function(e,t,l){var a=(e=e||{}).random||(e.rng||i)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){l=l||0;for(var n=0;n<16;++n)t[l+n]=a[n];return t}return d(a)}}}]);